# Задание 2.

## Система контроля версий

1. Выбираем Git как систему контроля версий (Github), если студент не знаком с ним отправляю его на:
- https://git-scm.com/
- https://github.com/

чтобы прочитал что это.

## Ревью кода.

Замечания:
#### Основные проблемы:
1. Обработка параметров запроса
* Переменная `defaults` создается с базовыми значениями, затем перезаписывается из `request.args`, но при этом все параметры остаются строками, числа не приводятся к `int`.

Совет: привести `limit` и `page` к числу, иначе возможны баги.

2. Подключение к `Elasticsearch`
* Подключение создается заново в каждом запросе, неэффективно.

Совет: вынести клиент в `app.config` и переиспользовать.

3. Поиск по полям
* Поиск идет только по `title`, в ТЗ надо еще `description`, `genre`, `actors_names`, `writers_names`, `director`.

Совет: сделать расширенный `multi_match`.

4. Доработка сортировки
* Сортировка `sort_order` может быть только `asc` или `desc`, но это не проверяется.

Совет: добавить валидацию.

5. Исправление `get_movie()`
* Если фильма нет, будет `KeyError`, так как `search_result['found']` не всегда есть.

Совет: реализовать через `search_result.get('found', False)`

## Полезные материалы по теме.

Elasticsearch DSL и запросы
- https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html
- https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html

Flask и подключение к БД
- https://flask.palletsprojects.com/en/2.2.x/appcontext/
- https://flask.palletsprojects.com/en/2.2.x/api/#flask.Flask.teardown_appcontext

## Итоговые рекомендации студенту:
1. Что исправить?
* Улучшить обработку параметров (строки → числа, валидация сортировки).
* Расширить поиск по нескольким полям.
* Оптимизировать подключение к `Elasticsearch` (использовать `g`).
* Исправить ошибки с `found` в `get_movie()`.
* Добавить requirements.txt и README.md, где будет описан процесс запуска.

2. Что изучить?
* Указал в разделе Полезные материалы по теме.

3. Как можно было бы улучшить?
* Переписать код с правками и протестировать снова
* Добавить логирование (можно через `logging`)
* `(host='0.0.0.0', port=80)` и `{'host': '192.168.11.128', 'port': 9200}` нужно вынести в конфиг