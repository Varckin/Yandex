# Задание 1.

## Система контроля версий

Выбираем Git как систему контроля версий (Github), если студент не знаком с ним, отправляю его на:
- https://git-scm.com/
- https://github.com/

чтобы прочитал что это.

## Ревью кода.

Замечания:
1. Структура кода:
* Можно было бы функции вынести в отдельные файлы и сделать модульную структуру.
* Добавить отдельный файл например `setup.py` для запуска проекта.

2. Работа с БД:
* Используется `sqlite3` и нет `close()` соединения, может привести к утечки ресурсов. Рекомендация использовать with конструкцию: `with sqlite3.connect() as connection`.
* SQL-запрос плохо читается, есть ошибки `(max(writer, writers)`, некорректный `GROUP_CONCAT`).
* Неправильная работа с `GROUP_CONCAT`, возможны дубликаты данных.

3. Работа с JSON и строками:
* В секции `if raw_writers[0] == '[':`, это похож на костыль который лучше использовать с `json.loads()` и `try/except`.
* `new_writers = ','.join([writer_row['id'] for writer_row in parsed])` делается строка вместо списка, надо преобразовывать в `list`.
* `actors_list = [(actor_id, __actors.get(int(actor_id))) for actor_id in raw_actors.split(',')]`, а именно в `raw_actors.split(',')` может привести к ошибкам если в данных есть пробелы.

4. Прочие замечания:
* `{'host': '192.168.1.252', 'port': 9200}` нужно вынести в конфиг.
* Нет обработок ошибок при работе с `bulk()`, критично.
* Проблемы с кодировкой, надо исправить кодировку в файле на `UTF-8`.
* Комментарии на русском и английском, но местами сломаны.

## Полезные материалы по теме.

- Elasticsearch Python API -- https://elasticsearch-py.readthedocs.io/en/latest/
- SQLite -- https://www.sqlite.org/docs.html
- Bulk API в Elasticsearch -- https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html

## Итоговые рекомендации студенту:

1. Что исправить?
* Переписать код с учетом замечаний.
* Работать с JSON и SQLite корректно `(json_group_array, json.loads())`.
* Сделать модульную структуру (разделить код по файлам).
* Добавить requirements.txt и README.md, где будет описан процесс запуска.
2. Что изучить?
* Указал в разделе Полезные материалы по теме.
3. Как можно было бы улучшить?
* Добавить логирование (модуль `logging`).
* Написать тесты (pytest + mock для SQLite и Elasticsearch).
* Сделать Docker-контейнер для удобного развертывания.